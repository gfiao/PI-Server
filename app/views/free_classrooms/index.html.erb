<div id="cont1" class="container space-top space-bottom" style="padding-bottom: 3%">

  <h1 class="page-header">Salas livres</h1>

  <div class="row">
    <%= form_tag(free_classrooms_path, :method => "get", id: "building-form") do %>
        <div class="col-xs-5 col-md-3">
          <%= collection_select :classroom, :building, Classroom.select(:building).uniq, :building,
                                :building, {:selected => @selected_building, include_blank: 'Todos'}, class: 'form-control' %>
        </div>
        <div class="col-md-2">
          <%= submit_tag "Filtrar", class: 'btn btn-default' %>
        </div>
    <% end %>
    <div class="col-md-3">
      <% if user_signed_in? %>
          <%= button_to('Adicionar nova sala livre', new_free_classroom_path, :method => :get, class: 'btn btn-default') %>
      <% end %>
    </div>
  </div>

  <table class="table table-striped" style="margin-top: 2%;">
    <tr>
      <th>Edificio</th>
      <th>Sala</th>
      <!--<th>De</th>-->
      <th>Livre por mais (hh:mm)</th>
      <!--<th>Teste</th>-->
      <th>Feedback</th>
      <% if !current_user.nil? %>
          <th></th>
          <% if current_user.id == 1 %>
              <th></th>
          <% end %>
      <% end %>
    </tr>


    <% def seconds_to_time(seconds) %>
        <% [seconds / 3600, seconds / 60 % 60].map { |t| t.to_s.rjust(2, '0') }.join(':') %>
    <% end %>

    <% @free_classrooms.each do |free_classroom| %>
        <% if free_classroom.to_time > Date.today %>
            <%#= free_classroom.to_time %>
            <!--<br>-->
            <%#= DateTime.now.utc+1.hours %>
            <!--<br><br>-->
            <% diff = free_classroom.to_time - (DateTime.now.utc+1.hours) %>
            <tr>
              <td><%= Classroom.find_by(id: free_classroom.classroom_id).building %></td>
              <td><%= Classroom.find_by(id: free_classroom.classroom_id).classroom %></td>
              <!--<td><%#= free_classroom.from_time.to_s(:short) %></td>-->
              <!--<td><%#= free_classroom.to_time.to_s(:short) %></td>-->
              <td><%= seconds_to_time(diff.to_i) %></td>
              <td><%= free_classroom.likes %></td>

              <% if !current_user.nil? %>
                  <td>
                    <span>
                        <%= link_to raw("<i class=\"glyphicon glyphicon-thumbs-up\"></i>"), free_classroom_path(free_classroom, "free_classroom[likes]" => free_classroom.likes + 1),
                                    :method => :put, class: 'btn btn-sm btn-success' %>
                    </span>
                    <span>
                        <%= link_to raw("<span class=\"glyphicon glyphicon-thumbs-down\"></span>"), free_classroom_path(free_classroom, "free_classroom[likes]" => free_classroom.likes - 1),
                                    :method => :put, class: 'btn btn-sm btn-danger' %>
                    </span>
                  </td>
                  <% if current_user.id == 1 %>
                      <td><%= button_to "X", free_classroom, method: :delete, class: "btn btn-danger btn-sm" %></td>
                  <% end %>
              <% end %>

            </tr>
        <% end %>
    <% end %>
  </table>


</div>